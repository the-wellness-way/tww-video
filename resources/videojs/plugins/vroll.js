!function(e,t){if("undefined"!=typeof window&&window.videojs)t(window.videojs);else if("function"==typeof define&&define.amd)define("vroll",["video.js"],function(e){return t(e.default||e)});else if("undefined"!=typeof module&&module.exports){var r=require("video.js");module.exports=t(r.default||r)}}(0,function(e){((e=e&&e.hasOwnProperty("default")?e.default:e).registerPlugin||e.plugin)("vroll",function(t,r){this.ready(function(){!function(t,r,n){var o=null;n&&n.trackUrl&&(o=n.trackUrl);var i,l=[],a=!1,s=!1,d=!1,f=!1,u=!1,c=!1,v=!1,p="undefined",m=-1,h=0,y=0,g=t.$(".vjs-tech");e.isAd=!1;var j,k=e.dom,b=t.el(),T=.1,C=e.browser,S=null,x=null,A=[],_=null,O=null,P=null;function q(e){return e}function I(e){return"[object Array]"===Object.prototype.toString.call(e)}e.vrollplugin=!0;var w=function(e,t){var r=document.createElement(e);return void 0!==t&&""!==t&&(r.className=t),r},N=function(e){return t.localize(e)};function E(){return t.duration()===1/0||"8"===C.IOS_VERSION&&0===t.duration()}var M=!0;if(!I(r)){var H=r;H.src&&H.src.length>5&&(H.offset?H.offset.indexOf("%")>-1&&E()&&(M=!1):H.offset=0,M&&((r=[])[0]=H))}if(I(r))for(var L=0,B=0;B<r.length;B++){var F=r[B];if(F.src&&"undefined"!==F.offset){F.loaded=!1,L=0;try{L=l[B].offset.indexOf("%")}catch(e){q(e)}L>0&&E()?L=1:l.push(F)}}function Q(){return t.el_.className.indexOf("vjs-casting")>0}t.ready(function(){O=t.el_.querySelector(".vjs-loading-spinner");var r=t.el_.querySelector(".vjs-big-play-button");if(x=t.el_.querySelector(".vjs-replay-button"),l.length>0){i=w("a","vast-blocker vjs-hidden"),t.el_.appendChild(i);var n=function(e){var t=e.el().querySelector(".vjs-tech"),r={ended:e.ended(),src:e.currentSrc(),currentTime:e.currentTime(),type:e.currentType(),currentSource:e.currentSource(),playing:!e.paused(),suppressedTracks:C(e)};return r.ended&&(r.currentTime=e.duration()),t&&(r.style=t.getAttribute("style")),r},C=function(e){var t=e.remoteTextTracks?e.remoteTextTracks():[];t&&I(t.tracks_)&&(t=t.tracks_),I(t)||(t=[]);var r=[];return t.forEach(function(e){r.push({track:e,mode:e.mode}),e.mode="disabled"}),r},M=function(){P.suppressedTracks.forEach(function(e){e.track.mode=e.mode})},H=function(e){var t=e.el().querySelector(".vjs-tech");"style"in P&&t.setAttribute("style",P.style||""),e.one("contentloadedmetadata",M),t.poster="",e.src(P.currentSource),e.load(),M(),E()?L():(L(),e.currentTime(P.currentTime))},L=function(){var e=t.play();void 0!==e&&e.then(function(){}).catch(function(){t.muted(!0),t.play()})};t.vroll.reset=function(){u=!1,d=!1,k.removeClass(b,"vjs-ad-playing"),t.one("playing",function(){for(var e=0;e<l.length;e++)l[e].loaded=!1})};for(var B=0;B<l.length;B++)l[B].offset||(l[0].offset=0);0===parseInt(l[0].offset,10)&&(t.offline?t.isPreroll=!1:(t.isPreroll=!0,!0!==v&&(v=!0,y=t.volume()),t.one("play",function(){if(t.isPreroll){var e=t.el_.querySelector(".vjs-poster");S=w("div","vjs-black-poster"),b.insertBefore(S,e.nextSibling),t.isPreroll=!1}}))),t.on("loadedmetadata",function(){if(t.isOffline)u=!1;else if(!u){u=!0;var C=t.duration();if(l.length>0&&!0!==f){f=!0;for(var I=0;I<l.length;I++){l[I].method="";var M=0;try{M=l[I].offset.indexOf("%",0)}catch(e){q(e)}if(M>0){var L=parseInt(l[I].offset,10);100===L||"end"===l[I].offset?(l[I].method="postroll",l[I].offset="end",A.push(l[I])):l[I].offset=C*(L/100)}else l[I].offset=parseInt(l[I].offset,10)}}if(l.length>0){t.on("timeupdate",function r(){l[l.length-1].loaded&&t.off("timeupdate",r);var n=e.dom.hasClass(b,"vjs-has-started"),o=E();n&&!0!==s&&!0!==t.isOffline&&!0!==o&&V(t.currentTime())});var B=function(){s?(clearTimeout(h),c=!1):(V(T+=.5),h=setTimeout(B,500))};E()&&(t.on("pause",function(){clearTimeout(h),c=!1}),t.on("playing",function(){e.dom.hasClass(b,"vjs-has-started")&&!0!==a&&l.length>0&&!0!==t.isOffline&&!0!==c&&(c=!0,h=setTimeout(B,500))}));var F=function(e){if(a)return t.trigger("vroll",{id:p.id,action:"completed"}),X("completed"),void G();if(null!==A){P||(P=n(t)),O.setAttribute("style","display:none !important");for(var r=0;r<A.length;r++)if(!0!==A[r].loaded)return t.trigger("vroll",{id:p.id,action:"completed"}),X("completed"),P||(P=n(t)),void U()}t.trigger("vroll",{id:p.id,action:"completed"}),X("completed"),z(!0),t.off("ended",F),setTimeout(function(){k.removeClass(x,"vjs-hidden")},500),check_playlist()};check_playlist=function(){t.playlist&&t.playlist.length>0&&(t.pause(),t.playlist.next(!0))},t.on("ended",F),t.one("play",function(){k.addClass(x,"vjs-hidden")});var U=function(){for(var e=0;e<A.length;e++)if(!0!==A[e].loaded)return void D(A[e]);z(),H(t,P)};function z(r){t.off("timeupdate",ee),t.off("error",Z),i.className="vjs-blocker vjs-hidden",r&&(A=null,Y(".vast-blocker")),a=!1,d=!1,s=!1,Y(".vast-skip-button"),setTimeout(function(){O.removeAttribute("style")},500),k.addClass(b,"vjs-has-started"),g.poster="",k.removeClass(b,"vjs-ad-playing"),e.isAd=!1}var D=function(r){r.loaded=!0,p=r,s=!0,e.isAd=!0,k.addClass(b,"vjs-ad-playing"),d=!0,t.on("error",Z);var n={src:r.src,type:r.type};t.src(n),O.setAttribute("style","display:none !important"),t.play(),t.one("play",function(){te()})},R=function(e,r){if(a=!0,e.loaded=!0,t.adhref=null,!Q()){p=e,d=!0;var o={src:e.src,type:e.type};if(P||(P=n(t)),O.setAttribute("style","display:none !important"),t.one("error",Z),t.src(o),t.currentTime(0),t.paused()){var i=!1;t.el_.className.indexOf("vjs-has-started")>0&&(i=!0),(t.ended()||i)&&t.play(),t.ended()&&t.play(),t.one("play",function(){te()})}else{te();var l=t.play();void 0!==l&&l.then(function(){}).catch(function(e){})}}};t.isPreroll&&(!0!==v&&(v=!0,y=t.volume(),t.volume(0)),!0!==E()&&R(l[0]));var V=function(r){if(!a&&!s){var n=r;n>0&&t.el_.querySelector(".vjs-poster").removeAttribute("style");for(var o=0;o<l.length;o++){var i=l[o];n>=i.offset&&!0!==a&&!0!==l[o].loaded&&(e.log.level("off"),!0!==Q()?R(i):l[o].loaded=!0)}}};i.onclick=function(){t.trigger("vroll",{id:p.id,action:"clicked"}),X("click")},t.on("chromecastConnected",function(){t.isPreroll&&(l[0].cancelled=!0,Y(".vast-skip-button"),_=null,m=-1,t.off("play",te),l[0].loaded=!0,t.isPreroll=!1,k.addClass(b,"vjs-has-started"),k.removeClass(b,"vjs-ad-playing"),t.off("timeupdate",ee),t.off("error",Z),H(t,P),P=null)});var $=function(){return t.paused()};function G(){Y(".vast-skip-button"),_=null,m=-1;var r=p.offset;p.loaded=!0,t.isPreroll=!1;var n=!1;k.addClass(b,"vjs-has-started");for(var o=0;o<l.length&&(l[o].offset===r&&!0!==l[o].loaded&&(t.off("timeupdate",ee),t.off("error",Z),a=!0,s=!0,l[o].loaded=!0,e.isAd=!0,k.addClass(b,"vjs-ad-playing"),d=!0,R(l[o],!0),n=!0),!n);o++);if(!0!==n){var i=!0;for(o=0;o<l.length;o++)!0!==l[o].loaded&&(i=!1);t.off("timeupdate",ee),t.off("error",Z),z(i),H(t,P),P=null}}var J,K,W=!1;function X(e,t){if(o){var r=new Image,n="?event="+e;p.id&&(n=n+"&id="+p.id),r.src=o+n}}function Y(e){var r=t.el_.querySelectorAll(e);if(r)for(var n=0;n<r.length;n++)r[n].parentNode.removeChild(r[n])}function Z(){a&&(t.trigger("vroll",{id:p.id,action:"error"}),X("error"),"postroll"===p.method?U():G(),d=!1)}function ee(){$()||function(e){e=t.currentTime();var r=t.duration();if(r>0){var n=((r=r.toFixed(0))/4).toFixed(0);if(e>n&&!0!==J&&(X("fistQuartile"),J=!0),e>2*n&&!0!==K&&(X("midpoint"),K=!0),e>3*n&&!0!==W&&(X("thirdQuartile"),W=!0),m>-1){var o=Math.ceil(m-e);if(k.removeClass(_,"vjs-hidden"),o>0){var i=N("Skip Ad in %%TIME%%");_.innerHTML="",w("p","vast-skip-button-text"),_.appendChild(j),j.innerHTML=i.replace("%%TIME%%",o)}else _.className="vast-skip-button enabled",_.innerHTML=N("Skip Ad")}}}(t.currentTime(),t.duration())}function te(){Q()||p.cancelled||(t.currentTime(0),t.on("timeupdate",ee),p.offset>0&&k.addClass(r,"vjs-hidden"),(m=p.skip>=0?parseInt(p.skip,10):-1)>-1&&(Y(".vast-skip-button"),(_=w("div","vast-skip-button vjs-hidden")).id="adSkipButton",_.ariaDisabled="false",_.tabIndex="0",j=w("p","vast-skip-button-text"),_.appendChild(j),t.el_.appendChild(_),_.onclick=function(e){!function(e){e.stopPropagation(),(" "+_.className+" ").indexOf(" enabled ")>=0&&(t.trigger("vroll",{id:p.id,action:"skipped"}),X("skipped"),"postroll"===p.method?U():G())}(e)}),k.addClass(b,"vjs-ad-playing"),k.addClass(r,"vjs-hidden"),S&&(b.removeChild(S),S=null,t.volume(y)),t.el_.querySelector(".vjs-poster").removeAttribute("style"),i.className="vast-blocker",void 0!==p.href?(i.removeAttribute("style"),i.href=p.href,t.adhref=p.href,i.target="_blank"):i.style.pointerEvents="none",s=!0,d&&(t.trigger("vroll",{id:p.id,action:"start"}),X("adstart"),d=!1))}}}})}})}(this,t,r)})})});